<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµìŠ¤íŠ¸ë¦¼ Â· ë™ë´‰ ì¶”ì²œ (Scoring Edition)</title>

    <style>
        .snowflake {
            position: fixed;
            top: -20px;
            color: #fff;
            user-select: none;
            z-index: 9999;
            pointer-events: none;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
            }
        }

        :root {
            --background: #0f0f12;
            /* Slightly cooler dark */
            --foreground: #ededed;
            --primary: #D32F2F;
            /* Christmas Red */
            --secondary: #2E7D32;
            /* Christmas Green */
            --accent: #FFD700;
            /* Gold */
            --surface: #1e1e1e;
            --surface-hover: #252525;
            --border: #333;
        }

        body {
            background: radial-gradient(circle at 50% 0%, #1a0b0b 0%, var(--background) 70%);
            /* Subtle red glow at top */
            color: var(--foreground);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }


        .main-container {
            width: 100%;
            max-width: 1200px;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .brand {
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 2px;
            color: var(--accent);
            /* Gold brand */
            margin-bottom: 12px;
            text-transform: uppercase;
            opacity: 0.9;
        }

        h1 {
            font-size: 32px;
            font-weight: 800;
            margin: 0 0 16px 0;
            background: linear-gradient(90deg, #fff, #ffaeae);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(211, 47, 47, 0.5);
        }


        .subtitle {
            font-size: 16px;
            color: #888;
            margin: 0;
            line-height: 1.5;
        }

        /* Search Input */
        .search-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            z-index: 100;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 1px solid var(--border);
            background-color: #1a1a1a;
            color: #fff;
            border-radius: 8px;
            outline: none;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(247, 37, 133, 0.2);
        }

        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: #222;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 4px;
            max-height: 240px;
            overflow-y: auto;
            z-index: 100;
            list-style: none;
            padding: 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            color: #ddd;
            border-bottom: 1px solid #333;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #333;
            color: #fff;
        }

        /* Results Section */
        .results-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .results-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .anchor-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 16px;
        }

        .anchor-info h2 {
            font-size: 20px;
            margin: 0;
            font-weight: 500;
        }

        .highlight {
            color: var(--secondary);
            font-weight: 700;
        }

        .score-badge {
            background-color: #222;
            border: 1px solid #444;
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 14px;
            color: #ccc;
        }

        .score-badge strong {
            color: var(--primary);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        /* Card Component */
        .card {
            background: linear-gradient(145deg, var(--surface), #141414);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            position: relative;
            overflow: hidden;
        }

        /* Top decoration for card (Red line) */
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(211, 47, 47, 0.15);
            /* Red glow */
            border-color: var(--primary);
        }


        .card-header {
            border-bottom: 1px solid var(--border);
            padding-bottom: 12px;
        }

        .rank-badge {
            background-color: var(--primary);
            /* Red badge */
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
        }


        .product-name {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
            color: #fff;
        }

        .category-name {
            font-size: 14px;
            color: #888;
            margin-top: 4px;
            display: block;
        }

        .score-bar-bg {
            background-color: #333;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .score-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            width: 0%;
            transition: width 1s ease-out;
        }

        .score-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--accent);
            float: right;
        }


        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            background: #111;
            padding: 12px;
            border-radius: 8px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-item label {
            font-size: 10px;
            color: #777;
            margin-bottom: 4px;
        }

        .stat-item span {
            font-size: 14px;
            font-weight: bold;
            color: #ddd;
        }

        .message-box {
            background-color: #222;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .message-header span {
            font-size: 12px;
            font-weight: bold;
            color: #bbb;
        }

        .copy-btn {
            background: none;
            border: 1px solid #555;
            color: #ddd;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background-color: #333;
            border-color: #777;
        }

        .message-text {
            font-size: 13px;
            line-height: 1.6;
            color: #ccc;
            white-space: pre-wrap;
            margin: 0 0 12px 0;
            font-family: inherit;
        }

        .coupon {
            font-size: 12px;
            color: var(--primary);
            font-weight: bold;
            text-align: center;
            border-top: 1px dashed #444;
            padding-top: 8px;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-size: 16px;
            padding: 40px;
            width: 100%;
        }

        /* Repurchase Summary Section */
        .repurchase-summary-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-group {
            display: flex;
            background: #111;
            padding: 4px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .tab-btn {
            background: none;
            border: none;
            color: #888;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--surface-hover);
            color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .summary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .summary-item {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .summary-item:hover {
            transform: scale(1.02);
            border-color: var(--secondary);
            background: rgba(46, 125, 50, 0.1);
        }

        .summary-item.selected {
            border-color: var(--accent);
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        .item-name {
            font-size: 13px;
            font-weight: 600;
            color: #eee;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-right: 8px;
        }

        .item-value {
            font-size: 15px;
            font-weight: 800;
            color: var(--secondary);
        }

        /* Strategy Analysis Section */
        .strategy-section {
            display: none;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 2px solid var(--accent);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .strategy-section.visible {
            display: block;
        }

        .strategy-header {
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 12px;
        }

        .strategy-header h2 {
            font-size: 22px;
            color: var(--accent);
            margin: 0;
        }

        .strategy-header p {
            font-size: 14px;
            color: #888;
            margin: 4px 0 0 0;
        }

        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .strategy-card {
            background: #222;
            border: 1px solid #444;
            border-radius: 12px;
            padding: 16px;
            position: relative;
        }

        .strategy-rank {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--accent);
            color: #000;
            font-weight: 900;
            padding: 2px 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .strategy-product-name {
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0;
            color: #fff;
        }

        .strategy-score-label {
            font-size: 12px;
            color: #aaa;
        }

        .strategy-score-val {
            font-size: 20px;
            font-weight: 800;
            color: var(--secondary);
            margin-left: 8px;
        }

        .strategy-reason {
            margin-top: 12px;
            font-size: 13px;
            color: #ccc;
            background: #111;
            padding: 10px;
            border-radius: 6px;
            line-height: 1.5;
        }
    </style>
</head>

<body>

    <div class="main-container">
        <header>
            <div class="brand">ğŸš€ EXTREME SCORING EDITION ğŸš€</div>
            <h1>ìµìŠ¤íŠ¸ë¦¼ Â· ì •ë°€ ì¶”ì²œ (ì œì™¸ í•„í„° ì ìš© v2)</h1>
            <p class="subtitle">ì•„ë¥´ê¸°ë‹Œ, ë¸”ë™ë§ˆì¹´, í™œë ¥ ë¶€ìŠ¤í„° ì œì™¸ / ë°ì´í„° ì •ë°€ ì ìˆ˜ ì œì•ˆ</p>
        </header>



        <section class="repurchase-summary-section">
            <div class="summary-header">
                <h2 class="summary-title">ğŸ“ˆ ì¬êµ¬ë§¤ìœ¨ ìˆœìœ„ ìš”ì•½</h2>
                <div class="tab-group">
                    <button class="tab-btn active" onclick="switchSummaryTab(60)">60ì¼ ì¬êµ¬ë§¤ìœ¨</button>
                    <button class="tab-btn" onclick="switchSummaryTab(90)">90ì¼ ì¬êµ¬ë§¤ìœ¨</button>
                </div>
            </div>
            <div id="summaryList" class="summary-list">
                <!-- Summary items will be injected here -->
            </div>
        </section>

        <!-- Strategy Analysis View -->
        <section id="strategySection" class="strategy-section">
            <div class="strategy-header">
                <h2>ğŸ¯ ìµœì  ìƒ˜í”Œë§ ë™ë´‰ ì „ëµ ë¶„ì„</h2>
                <p id="strategySubtitle">ì „ëµ ê°€ì´ë“œ</p>
            </div>
            <div id="strategyGrid" class="strategy-grid">
                <!-- Strategy cards will be injected here -->
            </div>
        </section>

        <section class="search-section">
            <h3 style="font-size: 16px; color: #888; margin: 0;">ğŸ” ì•µì»¤ ì œí’ˆ ì„ íƒ</h3>
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="ì œí’ˆëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ)"
                    autocomplete="off">
                <ul id="searchDropdown" class="dropdown"></ul>
            </div>
        </section>

        <div id="resultsContainer" class="results-section">
            <!-- Results will be injected here -->
        </div>
    </div>

    <script>
        // --- Data Injection ---
        // Expanded Dummy Data for Demo
        const rawRR = `êµ¬ë§¤ìƒí’ˆ	ì¬êµ¬ë§¤ìœ¨_30ì¼	ì¬êµ¬ë§¤ìœ¨_60ì¼	ì¬êµ¬ë§¤ìœ¨_90ì¼	ì¬êµ¬ë§¤ìœ¨_180ì¼
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	10.5	20.1	25.5	30.2
ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	8.2	15.3	18.9	22.1
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	12.1	21.5	28.3	35.4
ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	15.2	25.6	32.4	40.1
ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	9.5	18.2	22.5	28.9
ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	7.8	14.2	17.6	21.5
ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	11.3	19.8	24.2	29.7
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	14.5	22.1	29.5	36.2
ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	9.2	16.5	20.1	25.4
ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	11.8	20.4	26.1	31.5
ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	13.2	23.5	30.1	38.2
ìµìŠ¤íŠ¸ë¦¼ ë£¨í…Œì¸	8.9	15.8	19.4	24.1`;

        const rawAR = `Aìƒí’ˆ	Bìƒí’ˆ	ë‘ìƒí’ˆ êµ¬ë§¤ ê±°ë˜ìˆ˜	ì‹ ë¢°ë„	í–¥ìƒë„
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	1,250	40.2%	3.50
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	890	25.5%	2.10
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	1,500	38.1%	3.60
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	450	10.0%	1.50
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	300	8.5%	1.20
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	1,100	32.5%	3.10
ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	1,250	45.5%	3.50
ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	600	15.2%	1.20
ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	400	12.1%	1.80
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	ìµìŠ¤íŠ¸ë¦¼ ë£¨í…Œì¸	2,100	55.5%	4.20
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	1,800	40.1%	3.10
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	900	22.3%	2.00
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	1,200	30.2%	2.50
ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	1,800	38.5%	3.10
ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	500	12.5%	0.90
ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	950	25.5%	2.20
ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	900	30.5%	2.00
ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	600	22.1%	2.80
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	1,200	35.5%	2.50
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	500	15.2%	1.20
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	800	28.5%	2.10
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	1,000	31.2%	2.90
ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	1,300	45.2%	3.80
ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	900	30.1%	2.50
ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	600	20.5%	1.90
ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	950	30.5%	2.80
ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	400	15.2%	1.50
ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	550	18.5%	2.20
ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	900	32.5%	2.80
ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	500	18.2%	1.60
ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	450	16.5%	1.40
ìµìŠ¤íŠ¸ë¦¼ ë£¨í…Œì¸	ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	1,900	50.5%	3.90
ìµìŠ¤íŠ¸ë¦¼ ë£¨í…Œì¸	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	600	20.1%	1.80
ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	1,400	42.5%	3.70
ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	850	28.5%	2.40
ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	400	15.5%	1.60
ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	350	12.5%	1.30`;

        const rawCtg = `êµ¬ë§¤ìƒí’ˆ	ì¹´í…Œê³ ë¦¬
ìµìŠ¤íŠ¸ë¦¼ ì•„ë¥´ê¸°ë‹Œ	ìš´ë™/ì—ë„ˆì§€
ìµìŠ¤íŠ¸ë¦¼ ë‹¨ë°±ì§ˆ ìŠ¬ë¦¼ ì‰ì´í¬	ë‹¨ë°±ì§ˆ/ì‰ì´í¬
ìµìŠ¤íŠ¸ë¦¼ ì˜¤ë©”ê°€3	ì˜¤ë©”ê°€3/ë£¨í…Œì¸
ìµìŠ¤íŠ¸ë¦¼ ìœ ì‚°ê· 	ì¥ê±´ê°•
ìµìŠ¤íŠ¸ë¦¼ ê°„ì¼€ì–´	ê°„/ëŒ€ì‚¬
ìµìŠ¤íŠ¸ë¦¼ ê´€ì ˆì¼€ì–´	ê´€ì ˆ
ìµìŠ¤íŠ¸ë¦¼ í™œë ¥ ë¶€ìŠ¤í„°	ì•„ë¥´ê¸°ë‹Œ/í™œë ¥
ìµìŠ¤íŠ¸ë¦¼ ë£¨í…Œì¸	ì˜¤ë©”ê°€3/ë£¨í…Œì¸
ìµìŠ¤íŠ¸ë¦¼ ë©€í‹°ë¹„íƒ€ë¯¼	ê¸°ì´ˆì˜ì–‘
ìµìŠ¤íŠ¸ë¦¼ ë§ˆê·¸ë„¤ìŠ˜	ê¸°ì´ˆì˜ì–‘
ìµìŠ¤íŠ¸ë¦¼ ë¸”ë™ë§ˆì¹´	ìš´ë™/ì—ë„ˆì§€
ìµìŠ¤íŠ¸ë¦¼ ì½œë¼ê²	ê¸°ì´ˆì˜ì–‘`;

        // --- Parsing Logic ---
        function parseTSV(content) {
            const lines = content.trim().split('\n');
            const headers = lines[0].split('\t').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split('\t');
                const row = {};
                headers.forEach((h, i) => {
                    row[h] = values[i] ? values[i].trim() : '';
                });
                return row;
            });
        }

        const rrData = parseTSV(rawRR);
        const arData = parseTSV(rawAR).map(row => ({
            productA: row['Aìƒí’ˆ'],
            productB: row['Bìƒí’ˆ'],
            transactionCount: parseInt((row['ë‘ìƒí’ˆ êµ¬ë§¤ ê±°ë˜ìˆ˜'] || '0').replace(/,/g, '')),
            confidence: parseFloat((row['ì‹ ë¢°ë„'] || '0').replace('%', '')),
            lift: parseFloat(row['í–¥ìƒë„'] || '0')
        }));
        const ctgData = parseTSV(rawCtg);

        const categoryMap = {};
        ctgData.forEach(c => {
            categoryMap[c['êµ¬ë§¤ìƒí’ˆ']] = c['ì¹´í…Œê³ ë¦¬'];
        });

        // --- Business Logic ---
        // Removed Category Scenario Map
        // New Scoring Logic: Score = (Lift * 10) + Confidence
        // This roughly scales to 0-100 based on typical retail data ranges.

        function calculateRecScore(lift, confidence) {
            return (lift * 10) + confidence;
        }

        function calculateRepurchaseScore(row) {
            if (!row) return 0;
            return (
                0.1 * parseFloat(row['ì¬êµ¬ë§¤ìœ¨_30ì¼'] || 0) +
                0.2 * parseFloat(row['ì¬êµ¬ë§¤ìœ¨_60ì¼'] || 0) +
                0.3 * parseFloat(row['ì¬êµ¬ë§¤ìœ¨_90ì¼'] || 0) +
                0.4 * parseFloat(row['ì¬êµ¬ë§¤ìœ¨_180ì¼'] || 0)
            );
        }

        // --- UI Operations ---
        const searchInput = document.getElementById('searchInput');
        const searchDropdown = document.getElementById('searchDropdown');
        const resultsContainer = document.getElementById('resultsContainer');

        function isValidRecommendation(productB) {
            return !productB.includes("ì•„ë¥´ê¸°ë‹Œ") &&
                !productB.includes("ë¸”ë™ë§ˆì¹´") &&
                !productB.includes("í™œë ¥ ë¶€ìŠ¤í„°");
        }

        // Get Unique Anchors that have at least one valid recommendation
        const validAnchors = new Set();
        arData.forEach(r => {
            if (isValidRecommendation(r.productB)) {
                validAnchors.add(r.productA);
            }
        });
        const anchorOptions = Array.from(validAnchors).sort();

        // Setup Search
        searchInput.addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = anchorOptions.filter(opt => opt.toLowerCase().includes(val));
            renderDropdown(filtered);
        });

        searchInput.addEventListener('focus', () => {
            renderDropdown(anchorOptions);
        });

        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                searchDropdown.classList.remove('show');
            }
        });

        function renderDropdown(options) {
            searchDropdown.innerHTML = '';
            if (options.length > 0) {
                searchDropdown.classList.add('show');
                options.forEach(opt => {
                    const li = document.createElement('li');
                    li.className = 'dropdown-item';
                    li.textContent = opt;
                    li.onclick = () => selectAnchor(opt);
                    searchDropdown.appendChild(li);
                });
            } else {
                searchDropdown.classList.remove('show');
            }
        }

        function selectAnchor(anchor) {
            searchInput.value = anchor;
            searchDropdown.classList.remove('show');
            renderResults(anchor);
        }

        // --- Repurchase Summary Logic ---
        const summaryList = document.getElementById('summaryList');
        const summaryTabBtns = document.querySelectorAll('.tab-btn');

        function switchSummaryTab(days) {
            summaryTabBtns.forEach(btn => {
                if (btn.textContent.includes(days + 'ì¼')) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            renderRepurchaseSummary(days);
        }

        function renderRepurchaseSummary(days) {
            const key = `ì¬êµ¬ë§¤ìœ¨_${days}ì¼`;
            const sortedData = [...rrData]
                .sort((a, b) => parseFloat(b[key] || 0) - parseFloat(a[key] || 0));

            let html = '';
            sortedData.forEach(item => {
                const name = item['êµ¬ë§¤ìƒí’ˆ'];
                html += `
                    <div class="summary-item" onclick="selectStrategyTarget('${name}', this)">
                        <span class="item-name" title="${name}">${name}</span>
                        <span class="item-value">${item[key]}%</span>
                    </div>
                `;
            });
            summaryList.innerHTML = html;
        }

        function selectStrategyTarget(targetName, element) {
            // UI Feedback
            document.querySelectorAll('.summary-item').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');

            analyzeReverseSampling(targetName);
        }

        function analyzeReverseSampling(targetName) {
            const strategySection = document.getElementById('strategySection');
            const strategySubtitle = document.getElementById('strategySubtitle');
            const strategyGrid = document.getElementById('strategyGrid');

            // 1. Logic: Target(Product B)ì„ ì£¼ëŠ”ê²Œ íš¨ê³¼ì ì¸ Anchor(Product A) ì°¾ê¸°
            let candidates = arData
                .filter(r => r.productB === targetName)
                .map(r => ({
                    ...r,
                    score: calculateRecScore(r.lift, r.confidence)
                }))
                .sort((a, b) => b.score - a.score);

            // 2. Render
            strategySubtitle.innerHTML = `<strong>'${targetName}'</strong> ì œí’ˆì„ ìƒ˜í”Œë¡œ ì¦ì •í–ˆì„ ë•Œ, ì‹¤êµ¬ë§¤ë¡œ ì´ì–´ì§ˆ í™•ë¥ ì´ ê°€ì¥ ë†’ì€ ì„ í–‰ êµ¬ë§¤ ì œí’ˆ(ì•µì»¤) ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.`;

            let html = '';
            const top3 = candidates.slice(0, 3);

            if (top3.length === 0) {
                html = `<p class="no-data" style="grid-column: 1/-1;">ë°ì´í„° ë¶„ì„ ê²°ê³¼, '${targetName}'ì„(ë¥¼) ìƒ˜í”Œë¡œ ì£¼ê¸°ì— ì í•©í•œ ì„ í–‰ êµ¬ë§¤ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>`;
            } else {
                top3.forEach((item, index) => {
                    html += `
                        <div class="strategy-card">
                            <span class="strategy-rank">STRATEGY TOP ${index + 1}</span>
                            <div class="strategy-product-name">${item.productA}</div>
                            <div style="margin-bottom: 12px;">
                                <span class="strategy-score-label">ìƒ˜í”Œë§ ì „ëµ ì§€ìˆ˜</span>
                                <span class="strategy-score-val">${item.score.toFixed(1)}</span>
                            </div>
                            <div class="strategy-reason">
                                ğŸ’¡ <strong>ë¶„ì„ ê²°ê³¼:</strong> '${item.productA}' êµ¬ë§¤ ê³ ê°ì€ '${item.productB}'ì— ëŒ€í•´ íƒ€ ê³ ê° ëŒ€ë¹„ <strong>${item.lift.toFixed(1)}ë°°</strong> ë†’ì€ ê´€ì‹¬ì„ ë³´ì…ë‹ˆë‹¤. <br>
                                í•´ë‹¹ ì œí’ˆ ë°°ì†¡ ì‹œ '${item.productB}' ìƒ˜í”Œì„ ë™ë´‰í•˜ë©´ ë³¸í’ˆ ì „í™˜ìœ¨ì´ ê°€ì¥ ë†’ì„ ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤.
                            </div>
                        </div>
                    `;
                });
            }

            strategyGrid.innerHTML = html;
            strategySection.classList.add('visible');

            // Scroll to section
            strategySection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Initialize Summary
        renderRepurchaseSummary(60);

        function renderResults(anchorName) {
            // 1. Logic
            // Filter (Exclude Arginine and Black Maca as targets)
            let candidates = arData.filter(r =>
                r.productA === anchorName &&
                isValidRecommendation(r.productB)
            );

            // Calculate Score for each
            candidates.forEach(c => {
                c.score = calculateRecScore(c.lift, c.confidence);
            });

            // Sort by Score Descending
            candidates.sort((a, b) => b.score - a.score);

            const top3 = candidates.slice(0, 3);

            // Anchor Score
            const anchorRR = rrData.find(r => r['êµ¬ë§¤ìƒí’ˆ'] === anchorName);
            const score = calculateRepurchaseScore(anchorRR);

            // 2. Render
            let html = `
            <div class="anchor-info">
                <h2>ì„ íƒëœ ì•µì»¤: <span class="highlight">${anchorName}</span></h2>
                <div class="score-badge">
                    ì¬êµ¬ë§¤ ê°€ì¤‘ ì ìˆ˜: <strong>${score.toFixed(2)}ì </strong>
                </div>
            </div>
            <div class="cards-grid">
        `;

            if (top3.length === 0) {
                html += `<p class="no-data">ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. (ë°ì´í„° ë¶€ì¡±)</p>`;
            } else {
                top3.forEach((item, index) => {
                    const catB = categoryMap[item.productB] || 'ê¸°íƒ€';
                    const message = `[ë§ì¶¤ ì¶”ì²œ] ê³ ê°ë‹˜, '${anchorName}'ê³¼(ì™€) ê°€ì¥ ê¶í•©ì´ ì¢‹ì€ ìƒí’ˆì…ë‹ˆë‹¤.\në°ì´í„° ë¶„ì„ ì ìˆ˜ ${item.score.toFixed(0)}ì ì„ ê¸°ë¡í•œ ${item.productB} ìƒ˜í”Œì„ ë“œë¦½ë‹ˆë‹¤. \në§ˆìŒì— ë“œì…¨ë‹¤ë©´, ì•„ë˜ íŠ¹ë³„ í˜œíƒì„ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”.`;

                    html += `
                <div class="card">
                    <div class="card-header">
                        <span class="rank-badge">TOP ${index + 1}</span>
                        <h3 class="product-name">${item.productB}</h3>
                        <span class="category-name">${catB}</span>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <span style="font-size: 12px; color: #888;">ì¶”ì²œ ì í•©ë„ Score</span>
                        <span class="score-value">${item.score.toFixed(1)}</span>
                        <div class="score-bar-bg">
                            <div class="score-bar-fill" style="width: ${Math.min(item.score, 100)}%;"></div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <label>í•¨ê»˜ êµ¬ë§¤ (Lift)</label>
                            <span>${item.lift.toFixed(2)}ë°°</span>
                        </div>
                        <div class="stat-item">
                            <label>ë™ë°˜ í™•ë¥  (Conf.)</label>
                            <span>${item.confidence}%</span>
                        </div>
                        <div class="stat-item">
                            <label>ê±°ë˜ìˆ˜ (Tx)</label>
                            <span>${item.transactionCount.toLocaleString()}ê±´</span>
                        </div>
                    </div>

                    <div class="message-box">
                        <div class="message-header">
                            <span>ê°ì‚¬ì¹´ë“œ ë¬¸êµ¬</span>
                            <button class="copy-btn" onclick="copyToClipboard(this, \`${message.replace(/\n/g, '\\n')}\`)">ë¬¸êµ¬ ë³µì‚¬ ğŸ“‹</button>
                        </div>
                        <pre class="message-text">${message}</pre>
                        <div class="coupon">[ì¿ í° í˜œíƒ] ìƒ˜í”Œ ì œí’ˆ ë³¸í’ˆ êµ¬ë§¤ ì „ìš© 10% í• ì¸</div>
                    </div>
                </div>
                `;
                });
            }

            html += `</div>`;
            resultsContainer.innerHTML = html;
            resultsContainer.classList.add('visible');
        }

        window.copyToClipboard = function (btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                const original = btn.textContent;
                btn.textContent = "ë³µì‚¬ë¨ âœ…";
                setTimeout(() => {
                    btn.textContent = original;
                }, 2000);
            });
        }

        // --- Snow Effect ---
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.textContent = ['â„', 'â…', 'â†'][Math.floor(Math.random() * 3)];
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.fontSize = Math.random() * 12 + 10 + 'px';
            snowflake.style.opacity = Math.random() * 0.7 + 0.3;

            const duration = Math.random() * 5 + 5;
            snowflake.style.animationDuration = duration + 's';
            snowflake.style.animationDelay = Math.random() * 5 + 's';

            document.body.appendChild(snowflake);

            setTimeout(() => {
                snowflake.remove();
            }, (duration + 5) * 1000);
        }

        // Initial batch
        for (let i = 0; i < 30; i++) {
            createSnowflake();
        }

        // Continuous generation
        setInterval(createSnowflake, 200);
    </script>

    <style>
        body {
            overflow-x: hidden;
            /* Prevent horizontal scrollbar from snowflakes */
        }

        .snowflake {
            position: fixed;
            top: -20px;
            /* Start above the viewport */
            color: #fff;
            z-index: 9999;
            pointer-events: none;
            /* Allow clicking through snowflakes */
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg);
            }

            100% {
                transform: translateY(100vh) rotate(360deg);
            }
        }
    </style>
</body>

</html>
```